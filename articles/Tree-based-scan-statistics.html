<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Tree Based Scan Statistics • TreeMineR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Tree Based Scan Statistics">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">TreeMineR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.3.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Tree-based-scan-statistics.html">Tree Based Scan Statistics</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/entjos/TreeMineR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Tree Based Scan Statistics</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/entjos/TreeMineR/blob/master/vignettes/Tree-based-scan-statistics.Rmd" class="external-link"><code>vignettes/Tree-based-scan-statistics.Rmd</code></a></small>
      <div class="d-none name"><code>Tree-based-scan-statistics.Rmd</code></div>
    </div>

    
    
<p>This vignette aims to give a short intoduction on how to use this
package to run tree-based scan statistics in R. Tree-based scan
statistic is a data driven method for identifying clusters of events
across a hierarchical tree. This could, e.g., be disease clusters across
the ICD-10 tree. This method is commonly used in pharmacovigilance to
identify potential side effects of drugs, using an agnostic approach.
Before we get started, let’s just define some terminology:</p>
<ul>
<li>
<strong>Leaf</strong> is the most detailed code that is available
for an event, e.g., the most detailed ICD-10 code for a diagnosis.</li>
<li>
<strong>Hierarchical structure</strong> is a system consisting of
different nodes in which each node has at least one parent node, except
for the root node.</li>
<li>
<strong>Cut</strong> is any node between the leaf node and the root
node.</li>
</ul>
<p>Please check <a href="https://doi.org/10.1002/pds.3423" class="external-link">Kulldorff et
al. (2013)</a> for a more detailed description of the method. Let’s load
the <code>TreeMineR</code> package to get started.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://entjos.github.io/TreeMineR/">TreeMineR</a></span><span class="op">)</span></span></code></pre></div>
<p>The <code>TreeMineR</code> package comes with the
<code>diagnosis</code> data set which includes simulated diagnosis data
on some exposed and unexposed individuals. In order to use the
<code>TreeMineR</code> function, we need to prepare the data in a
special format. Each row in our data set needs to correspond to one
diagnosis with information on which individual received this diagnosis
and whether the individual was exposed or unexposed. The diagnosis
dataset, is fortunately, already in the right format. Let’s have a
look:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">diagnoses</span></span>
<span><span class="co">#&gt;           id   leaf exposed</span></span>
<span><span class="co">#&gt;        &lt;int&gt; &lt;char&gt;   &lt;num&gt;</span></span>
<span><span class="co">#&gt;     1:     1   K251       0</span></span>
<span><span class="co">#&gt;     2:     2   Q702       0</span></span>
<span><span class="co">#&gt;     3:     3    G96       0</span></span>
<span><span class="co">#&gt;     4:     3   S949       0</span></span>
<span><span class="co">#&gt;     5:     4   S951       0</span></span>
<span><span class="co">#&gt;    ---                     </span></span>
<span><span class="co">#&gt; 22985:   999   V539       1</span></span>
<span><span class="co">#&gt; 22986:   999   V625       1</span></span>
<span><span class="co">#&gt; 22987:   999   G823       1</span></span>
<span><span class="co">#&gt; 22988:  1000    L42       1</span></span>
<span><span class="co">#&gt; 22989:  1000   T524       1</span></span></code></pre></div>
<p>Besides our diagnosis data, we also need an object that defines our
hierarchical tree. This data frame includes a variable called
<code>pathString</code>, which defines the full path for each leaf.
Let’s look at an example. The <code>pathString</code> for the ICD-10
code B369 looks as follows: the code is part of the group B36, which in
turn is part of the block B35-B49, which in turn is part of the ICD-10
chapter 1, which in turn is part of the ICD-10-SE coding system. The
full path, hence, is <code>ICD-10-SE/01/B35-B49/B36/B369</code>.
Important is, that each of the leafs included in the data also has one
row in the tree. E.g., if we have an observation with a diagnosis code
B36, we also need to add a row to the tree file which finishes with B36,
i.e., <code>ICD-10-SE/01/B35-B49/B36</code>.</p>
<p>The ICD-10-SE, is already included in the TreeMineR package and can
be used out of the box. If you want to use another tree structure, take
a look at the <code>create_tree</code> function, which makes it easy to
define new tree structures. Also the <code>drop_cuts</code> function can
be useful if you want to remove some leafs from your tree. This is,
e.g., helpful in situations, where you <em>a priori</em> want to remove
some ICD-10 chapters from your analysis.</p>
<p>Let’s have a look at the first rows of the ICD-10-SE tree file:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">icd_10_se</span><span class="op">)</span></span>
<span><span class="co">#&gt;             pathString</span></span>
<span><span class="co">#&gt; 1 ICD-10-SE/01/A00-A09</span></span>
<span><span class="co">#&gt; 2 ICD-10-SE/01/A15-A19</span></span>
<span><span class="co">#&gt; 3 ICD-10-SE/01/A20-A28</span></span>
<span><span class="co">#&gt; 4 ICD-10-SE/01/A30-A49</span></span>
<span><span class="co">#&gt; 5 ICD-10-SE/01/A50-A64</span></span>
<span><span class="co">#&gt; 6 ICD-10-SE/01/A65-A69</span></span></code></pre></div>
<p>Once we have the tree file defined and the data in the right format,
we can use the <code><a href="../reference/TreeMineR.html">TreeMineR()</a></code> function to identify potential
event clusters. The <code><a href="../reference/TreeMineR.html">TreeMineR()</a></code> function has an inbuild
parallelisation via the future package, which can be set up using the
<code>future_control</code> argument.</p>
<p>Let’s do a test run:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="fu"><a href="../reference/TreeMineR.html">TreeMineR</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">diagnoses</span>,</span>
<span>  tree  <span class="op">=</span> <span class="va">icd_10_se</span>,</span>
<span>  p <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">11</span>,</span>
<span>  n_exposed <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  n_unexposed <span class="op">=</span> <span class="fl">10000</span>,</span>
<span>  n_monte_carlo_sim <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  random_seed <span class="op">=</span> <span class="fl">124</span>,</span>
<span>  future_control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"sequential"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;       cut  n1   n0 risk1  risk0       RR      llr          p</span></span>
<span><span class="co">#&gt; 1      12 122  669 0.122 0.0669 1.823617 16.18714 0.04761905</span></span>
<span><span class="co">#&gt; 2      11 132  782 0.132 0.0782 1.687980 13.65786 0.04761905</span></span>
<span><span class="co">#&gt; 3 V01-X59 241 1687 0.241 0.1687 1.428571 12.26816 0.04761905</span></span>
<span><span class="co">#&gt; 4 V01-V99 210 1438 0.210 0.1438 1.460362 11.95732 0.09523810</span></span>
<span><span class="co">#&gt; 5      15 133  822 0.133 0.0822 1.618005 11.79775 0.09523810</span></span>
<span><span class="co">#&gt; 6      19 306 2281 0.306 0.2281 1.341517 10.80614 0.09523810</span></span></code></pre></div>
<p>In our data, we could identify three event clusters (Ch. 12, Ch. 11,
V01-X59) which passed the p &lt; 0.05 threshold, suggesting that exposed
individuals have a higher risk of being diagnosed with these disease
groups than unexposed individuals. Usually, you would like to increase
the number of Monte Carlo simulation runs to increase the stability of
the results.</p>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Joshua P. Entrop, Viktor Wintzell.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
